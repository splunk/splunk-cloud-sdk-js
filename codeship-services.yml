# TODO: Refactor to leverage volume usage idiomatically 
splunk-cloud-sdk-shared-token-fetcher:
  image: 137462835382.dkr.ecr.us-west-1.amazonaws.com/splunk-cloud-sdk-shared-token-fetcher:latest
  dockercfg_service: aws-generator
  encrypted_env_file: ci/env.encrypted
  volumes:
    - ./okta:/okta

splunk-cloud-client-js-build:
  build:
    image: splunk/splunk-cloud-client-js-build
    dockerfile: ci/Dockerfile
  encrypted_env_file: ci/env.encrypted

splunk-cloud-client-js-with-stubby:
  build:
    image: splunk/splunk-cloud-client-js-with-stubby
    dockerfile: ci/Dockerfile
  encrypted_env_file: ci/env.encrypted
  environment:
    - CI=true
  depends_on:
    - splunk-cloud-sdk-shared-stubby

splunk-cloud-client-js-against-playground:
  build:
    image: splunk/splunk-cloud-client-js-against-playground
    dockerfile: ci/Dockerfile
  encrypted_env_file: ci/env.encrypted
  depends_on:
    - splunk-cloud-sdk-shared-token-fetcher
  volumes_from:
    - splunk-cloud-sdk-shared-token-fetcher
  environment:
    - CI=true

splunk-cloud-sdk-shared-stubby:
  image: 137462835382.dkr.ecr.us-west-1.amazonaws.com/splunk-cloud-sdk-shared-stubby:latest
  dockercfg_service: aws-generator

splunk-cloud-client-js-whitesource:
  depends_on:
    - splunk-cloud-client-js-build
  dockercfg_service: aws-generator
  encrypted_env_file: ci/env.encrypted
  image: 137462835382.dkr.ecr.us-west-1.amazonaws.com/splunk-cloud-sdk-shared-whitesource:latest
  volumes_from:
    - splunk-cloud-client-js-build

aws-generator:
  add_docker: true
  image: codeship/aws-ecr-dockercfg-generator
  encrypted_env_file: ci/shared/env.encrypted
