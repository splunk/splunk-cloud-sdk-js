- type: serial
  name: Testing
  steps:
  - name: Fetch Okta Token
    service: ssc-sdk-shared-token-fetcher
    command: true
  - name: Functional Tests With Code Coverage
    service: ssc-client-js-with-stubby
    command: bash -c "yarn codecov"
  - type: parallel
    name: Integration Tests And Example Tests
    steps:
        # Integration Tests
      - name: Integration Tests - Not Gated
        service: ssc-client-js-against-playground
        exclude: ^(master|develop)$
        command: bash -c "allow_failures=1 ./ci/integration/runtests.sh"
      - name: Integration Tests - Gated
        service: ssc-client-js-against-playground
        tag: ^(master|develop)$
        command: bash -c "allow_failures=0 ./ci/integration/runtests.sh"
        # Example Tests
      - name: Example Tests - Not Gated
        service: ssc-client-js-against-playground
        exclude: ^(master|develop)$
        command: bash -c "allow_failures=1 ./ci/integration/runExamples.sh"
      - name: Example Tests - Gated
        service: ssc-client-js-against-playground
        tag: ^(master|develop)$
        command: bash -c "allow_failures=0 ./ci/integration/runExamples.sh"

- type: serial
  name: Documentation
  steps:
    - name: Build Docs
      service: ssc-client-js-with-stubby
      command: bash -c "yarn docs"

# TODO: Add Whitesource tests here

- type: serial
  name: Deploy
  steps:
    - name: Deploy to NPM
      service: ssc-client-js-with-stubby
      tag: master
      command: ./ci/publish.sh
