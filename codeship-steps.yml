- type: serial
  name: stubby 
  steps:
    - name: stubby tests with coverage
      service: ssc-client-js-with-stubby
      command: bash -c "yarn run codecov"
    - type: serial
      name: integration
      steps:
      - name: fetch Okta token
        service: ssc-sdk-shared-token-fetcher
        command: echo "hi"
      - type: parallel
        name: integration tests
        steps:
          - name: integration tests - not gated
            service: ssc-client-js-against-playground
            exclude: ^(master|develop)$
            command: bash -c "allow_failures=1 ./ci/integration/runtests.sh"
          - name: integration tests - gated
            service: ssc-client-js-against-playground
            tag: ^(master|develop)$
            command: bash -c "allow_failures=0 ./ci/integration/runtests.sh"
    - name: deploy
      service: ssc-client-js-with-stubby
      tag: master
      command: ./ci/publish.sh
